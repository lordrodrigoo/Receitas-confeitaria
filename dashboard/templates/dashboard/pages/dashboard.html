{% extends "global/base.html" %}

{% block title %}Dashboard ({{ user.username }}) {% endblock title %}

{% block content %}
   <div class="main-content center container">
      {% include "dashboard/partials/login_message.html" %}
      {% include "global/partials/messages.html" %}
        <h2>Painel de controle ({{ user.username }})</h2>



<div class="dashboard-section">
   <h3><i class="fas fa-utensils"></i> Suas Receitas</h3>
   <table class="dashboard-table">
      <thead>
         <tr>
            <th>Título</th>
            <th>Categoria</th>
            <th>Ações</th>
         </tr>
      </thead>
      <tbody>
         {% for recipe in recipes %}
            <tr>
               <td>
                  <a href="{% url "dashboard:dashboard_recipe_edit" recipe.id %}">{{ recipe.title }}</a>
               </td>
               <td>{{ recipe.category.name|default:'-' }}</td>
               <td>
                  <a href="{% url "dashboard:dashboard_recipe_edit" recipe.id %}" class="btn-edit">Editar</a>
                  <form class="inline-form form-delete" action="{% url "dashboard:dashboard_recipe_delete" %}" method="post" style="display:inline;">
                     {% csrf_token %}
                     <input type="hidden" name="id" value="{{ recipe.id }}" />
                     <button class="btn-delete" type="submit" title="Excluir">Excluir</button>
                  </form>
               </td>
            </tr>
         {% empty %}
            <tr><td colspan="3">Você ainda não tem receitas cadastradas.</td></tr>
         {% endfor %}
      </tbody>
   </table>
</div>

<div class="dashboard-section">
   <h3><i class="fas fa-layer-group"></i> Categorias</h3>
   <table class="dashboard-table">
      <thead>
         <tr>
            <th>Nome</th>
            <th>Ações</th>
         </tr>
      </thead>
      <tbody>
         {% for category in categories %}
            <tr>
               <td>{{ category.name }}</td>
               <td>
                  <form class="inline-form form-delete-category" action="{% url 'dashboard:dashboard_category_delete' %}" method="post" style="display:inline;">
                     {% csrf_token %}
                     <input type="hidden" name="category_id" value="{{ category.id }}">
                     <button class="btn-delete" type="submit" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir esta categoria?');">Excluir</button>
                  </form>
               </td>
            </tr>
         {% empty %}
            <tr><td colspan="2">Nenhuma categoria cadastrada.</td></tr>
         {% endfor %}
      </tbody>
   </table>
</div>

<div class="dashboard-section">
   <h3><i class="fas fa-users"></i> Usuários</h3>
   <table class="dashboard-table">
      <thead>
         <tr>
            <th>Nome</th>
            <th>Usuário</th>
            <th>Ações</th>
         </tr>
      </thead>
      <tbody>
         {% for user in users %}
            <tr>
               <td>{{ user.get_full_name|default:user.username }}</td>
               <td>{{ user.username }}</td>
               <td>
                  <form class="inline-form form-delete-user" action="{% url 'dashboard:dashboard_user_delete' %}" method="post" style="display:inline;">
                     {% csrf_token %}
                     <input type="hidden" name="user_id" value="{{ user.id }}">
                     <button class="btn-delete" type="submit" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir este usuário?');">Excluir</button>
                  </form>
               </td>
            </tr>
         {% empty %}
            <tr><td colspan="3">Nenhum usuário comum cadastrado.</td></tr>
         {% endfor %}
      </tbody>
   </table>
</div>


   </div>
<script>
   document.addEventListener('DOMContentLoaded', function() {
      const deleteForms = document.querySelectorAll('.form-delete');
      deleteForms.forEach(function(form) {
         form.addEventListener('submit', function(e) {
            if (!confirm('Você tem certeza que deseja deletar esta receita?')) {
               e.preventDefault();
            }
         });
      });
   });
</script>
{% endblock %}